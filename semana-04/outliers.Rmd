---
title: "R Notebook"
output: html_notebook
---

#########################################################
#  An?lisis Univariado de Valores Extremos              #
#########################################################

```{r}
#-------------------------------------------------------#
#  Simulaci?n                                           #
# ------------------------------------------------------#

set.seed(123)
dat <- matrix(rnorm(5*100),100,5)
summary(dat)
boxplot(dat)
#pairs(dat) 

```
Se ve que a pesar de haber simulado los datos, aparecen outlier porque de acuerdo a turkey existe una probabilidad de que algunos datos sean posibles outlier (70% ?)

```{r}
# (introducimos un outlier)
dat[23,4] <- dat[23,4] * 10
summary(dat)
boxplot(dat)
pairs(dat)

which.min(dat[,4])

```


#-------------------------------------------------------#
#  Ejemplo: Empleados de Midwestern bank (1965)         #
# ------------------------------------------------------#
# ID = C?digo del empleado                              #
# SALBEG = Salario inicial                              #
# GENDER = G?nero                                       #
# JOBTIME = Meses en el  trabajo                        #
# AGE = Edad (a?os)                                     #
# SALNOW = Salario actual                               #
# EDLEVEL = Experiencia acad?mica (a?os)                #
# WORKEXP = Experiencia laboral previa (a?os)           #
# JOBCAT = Categor?a laboral                            #
# MINORITY = Pertenece a minor?a racial                 #
#-------------------------------------------------------#

```{r}

Bank <- read.delim("BwBankTab.dat" )
head(Bank)

```

# Asignar etiquetas y valores perdidos

```{r}
Bank$GENDER <- as.factor(Bank$GENDER); levels(Bank$GENDER)<- c("Hombre","Mujer",NA)
Bank$MINORITY <- as.factor(Bank$MINORITY); levels(Bank$MINORITY)<- c("Blanco","No blanco",NA)
Bank$JOBCAT <- as.factor(Bank$JOBCAT)
levels(Bank$JOBCAT)<- c(NA, "Oficinista", "Asistente", "Seguridad", 
                        "Acad?mico", "Empleado", "Ejecutivo", "T?cnico" )
```

# Se eliminan datos perdidos, porque no es parte de la revision de outlier
```{r}
Bank$SALBEG[Bank$SALBEG == 0] <- NA
Bank$JOBTIME[Bank$JOBTIME == 0] <- NA
Bank$AGE[Bank$AGE == 0] <- NA
Bank$SALNOW[Bank$SALNOW == 0] <- NA
Bank$EDLEVEL[Bank$EDLEVEL == 0] <- NA
Bank$WORKEXP[Bank$WORKEXP == 0] <- NA

summary(Bank)
Bank <- na.omit(Bank)

```

```{r}
# Cuando sobrebapa en 1.5 el rango intercuartilo de la caja
# Box Plots
#------------

library(dplyr)  # me permite seleccionar datos

library(ggplot2) # construir graficos mas vistosas

# No me interesa saber que observacion es un outlier, lo que me interesa 
# el nombre o identificacion del trabajador, es lo que hace esta funcion
is_outlier <- function(x) {
  return(x < quantile(x, 0.25) - 1.5 * IQR(x) | x > quantile(x, 0.75) + 1.5 * IQR(x))
}

```
```{r}
p1 <- Bank %>%
  mutate(outlier = ifelse(is_outlier(SALBEG), ID, as.numeric(NA))) %>%
  ggplot(., aes(x = 1, y = SALBEG)) +
  geom_boxplot(fill="lightblue") +
  geom_text(aes(label = outlier), na.rm = TRUE, hjust = -0.3) +
  theme_bw()



```





